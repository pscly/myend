# Flask 服务接口文档

## 目录

1. [身份验证接口](#身份验证接口)
2. [钉钉消息推送接口](#钉钉消息推送接口)
3. [文件共享接口](#文件共享接口)
4. [邮件接口](#邮件接口)
5. [支付接口](#支付接口)
6. [一次性网页接口](#一次性网页接口)
7. [DDNS接口](#ddns接口)
8. [根路由接口](#根路由接口)
9. [文本存储接口](#文本存储接口)
10. [后端接口](#后端接口)
11. [消息推送中心接口](#消息推送中心接口)
12. [软件验证接口](#软件验证接口)

## 身份验证接口

### 登录

**URL:** `/login`

**方法:** `GET`, `POST`

**参数:**
- `name`: 用户名
- `pwd`: 密码

**响应:** 登录成功后重定向到主页，失败则返回错误信息

**示例请求:**
```
POST /login
{
  "name": "username",
  "pwd": "password"
}
```

### 注册

**URL:** `/reg`

**方法:** `GET`, `POST`

**参数:**
- `name`: 用户名
- `pwd`: 密码
- `y_code`: 邀请码，必须等于当前时间格式(HHMM+dd)

**响应:** 注册成功后重定向到主页，失败则返回错误信息

### 登出

**URL:** `/logout`

**方法:** `GET`

**响应:** 登出后重定向到主页

### 验证登录状态

**URL:** `/ok1`

**方法:** `GET`, `POST`

**响应:**
- 已登录: `{"msg": "login ok, 11111", "user": "用户名"}`
- 未登录: 返回未登录提示页面

## 钉钉消息推送接口

### 发送消息到钉钉群

**URL:** `/d1/`

**方法:** `POST`, `GET`

**参数:**
- `bt` (可选): 消息标题
- `content`: 消息内容，可以是字符串或JSON对象

**示例请求:**
```
POST /d1/
{
  "data": {
    "bt": "测试标题",
    "content": "这是一条测试消息"
  }
}
```

**响应:**
```json
{
  "message": "已经尝试发送消息了",
  "消息内容是": "# 测试标题\n\n这是一条测试消息\n\n---\n\n> 2023-05-20 15:30:45",
  "标题是": "测试标题"
}
```

**说明:**
- 如果提供了标题(`bt`)，将使用markdown格式发送消息
- 如果没有提供标题，将把整个请求数据作为JSON发送，标题默认为"无标题的消息(json)"

## 文件共享接口

### 获取文件列表

**URL:** `/files/`

**方法:** `GET`

**响应:** 返回文件列表页面

**权限:** 需要登录

### 上传文件

**URL:** `/files/upload`

**方法:** `POST`

**参数:**
- 文件数据

**响应:** 上传成功后返回成功信息，失败则返回错误信息

**权限:** 需要登录

### 下载指定文件

**URL:** `/files/<file_name>`

**方法:** `GET`

**参数:**
- `file_name`: 文件名

**响应:** 返回文件内容或错误信息

**权限:** 需要登录

## 邮件接口

### 发送邮件

**URL:** `/email/send`

**方法:** `POST`

**参数:**
- `to`: 收件人邮箱
- `subject`: 邮件主题
- `content`: 邮件内容
- `attachments` (可选): 附件

**响应:** 发送成功后返回成功信息，失败则返回错误信息

**权限:** 需要登录

## 支付接口

### 发起支付请求

**URL:** `/pays/submit`

**方法:** `GET`, `POST`

**参数:**
- `pid`: 商户ID
- `type`: 支付方式(alipay/tenpay/qqpay/wxpay)
- `out_trade_no`: 商户订单号
- `notify_url`: 服务器异步通知地址
- `return_url`: 页面跳转通知地址
- `name`: 商品名称
- `money`: 金额
- `sitename`: 网站名称
- `sign`: 签名字符串
- `sign_type`: 签名类型，默认MD5

**响应:** 重定向到支付页面或返回错误信息

### 支付回调通知

**URL:** `/pays/notify`

**方法:** `POST`

**参数:**
- `trade_no`: 支付平台订单号
- `out_trade_no`: 商户订单号
- `money`: 支付金额
- `name`: 商品名称
- `trade_status`: 交易状态
- `sign`: 签名字符串

**响应:** 处理成功返回"success"，失败返回错误信息

## 一次性网页接口

### 重定向到一次性URL

**URL:** `/to_url/`

**方法:** `GET`, `POST`

**参数:**
- `x`: URL标识符，必填

**示例请求:**
```
GET /to_url/?x=pscly
```

**响应:** 重定向到对应的URL或错误信息

**说明:**
- 每个URL只能被访问一次
- 访问后URL的计数器会减1
- 当计数器小于1时，将返回错误或重定向到错误页面

## DDNS接口

### 更新DNS记录

**URL:** `/ddns/`

**方法:** `GET`, `POST`

**参数:**
- `ip`: IP地址，如果不提供则使用请求的IP
- `ym`: 域名，默认为"pscly.cn"
- `name`: 子域名，必填
- `ym_id`: 域名ID，必填
- `y`: 验证码
- `v`: IP版本，6表示IPv6，否则为IPv4
- `r_len`: 返回的历史IP长度，默认为5

**示例请求:**
```
GET /ddns/?name=test&ym_id=1178299063&ip=192.168.1.1
```

**响应:**
```json
{
  "code": 0,
  "msg": "更新成功",
  "data": {
    "历史IP": ["192.168.1.1", "192.168.1.2"]
  }
}
```

## 根路由接口

### 主页

**URL:** `/`

**方法:** `GET`

**响应:** 返回主页面

### 查看当前时间

**URL:** `/md`

**方法:** `GET`

**响应:** 返回当前时间信息

### 重定向到邮件页面

**URL:** `/emi/`

**方法:** `GET`, `POST`

**响应:** 重定向到`/email/`页面

### 访问静态文件

**URL:** `/<filename>`

**方法:** `GET`

**参数:**
- `filename`: 文件名

**响应:** 返回`static/geng`文件夹下的对应文件

## 文本存储接口

### 上传文本

**URL:** `/texts/up`

**方法:** `GET`, `POST`

**参数:**
- `key`: 密钥
- `rj_id`: 软件ID
- `mqj`: 机器码
- `text`: 保存的数据文本

**响应:** 成功返回保存结果，失败返回错误信息

### 下载文本

**URL:** `/texts/down1`

**方法:** `GET`, `POST`

**参数:**
- `y`: 验证码，必须等于当前日期和小时(格式为"ddHH")
- `mqj` (可选): 机器码，用于筛选

**响应:** 成功返回文本数据，失败返回错误信息

## 后端接口

### 获取后端数据

**URL:** `/end1/`

**方法:** `GET`, `POST`

**参数:**
- 请求头中需包含`is_y`参数，值为1

**响应:** 返回请求数据及IP信息

**示例响应:**
```json
{
  "ip": "192.168.1.1",
  "is_y": 1,
  "其他数据": "..."
}
```

## 消息推送中心接口

### 获取设备列表

**URL:** `/msg1/`

**方法:** `GET`, `POST`

**响应:** 返回设备列表页面

**权限:** 需要登录

### 添加设备

**URL:** `/msg1/add/`

**方法:** `GET`, `POST`

**参数:**
- `name`: 设备名称
- `url`: 设备URL

**响应:** 添加成功后返回成功信息，失败则返回错误信息

**权限:** 需要登录

### 删除设备

**URL:** `/msg1/del/`

**方法:** `GET`, `POST`

**参数:**
- `name`: 设备名称

**响应:** 删除成功后返回成功信息，失败则返回错误信息

**权限:** 需要登录

## 软件验证接口

### 生成密钥

**URL:** `/rum/addkey`

**方法:** `GET`, `POST`

**参数:**
- `y`: 验证码，必须等于当前日期和小时(格式为"ddHH")
- `rj_id`: 软件ID
- `key`: 卡类型(zk/tk/yk/nk)
- `head`: 创建者
- `jie`: 是否完全绑定机器码(1/0)
- `num`: 卡数量

**响应:** 生成成功后返回密钥信息，失败则返回错误信息

### 验证密钥

**URL:** `/rum/`

**方法:** `GET`, `POST`

**参数:**
- `key`: 密钥
- `rj_id`: 软件ID
- `mqj`: 机器码

**响应:** 验证成功返回成功信息，失败则返回错误信息

### 获取账号信息

**URL:** `/rum/getaut`

**方法:** `GET`, `POST`

**响应:** 返回账号信息

### 获取账号列表

**URL:** `/rum/getauts`

**方法:** `GET`, `POST`

**响应:** 返回账号列表

### 添加账号

**URL:** `/rum/addaut`

**方法:** `GET`, `POST`

**参数:**
- `y`: 验证码，必须等于当前日期和小时(格式为"ddHH")
- `aut`: 账号
- `jishu`: 计数，默认为0

**响应:** 添加成功后返回账号信息，失败则返回错误信息

---

注意：部分接口可能需要身份验证或特定权限才能访问。请确保在使用前已获得相应权限。